<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tarragon Portal</title>
    <link href="css/tarragon.css" rel="stylesheet" type="text/css">
    <link rel="apple-touch-icon" sizes="180x180" href="favico/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favico/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favico/favicon-16x16.png">
    <link rel="manifest" href="favico/site.webmanifest">

</head>
<body>

<div class="navbar" id="topnav">
    <a href="index.html#">Home</a>
    <a href="index.html">Dragons</a>
    <a href="index.html#contact">Contact</a>
    <a href="index.html#discord">Discord</a>
</div>
<div class="content" style="padding-top: 50px">

    <div class="row">
        <div class="column" id="list"></div>
        <div class="column">
            <div class="properties">
                <h2 id="prop_event_name" contenteditable="true">prop_name</h2>
                <input id="prop_event_date" type="date">
                <button onClick="apply_edits()">EDIT</button>
            </div>
        </div>
    </div>

    <script>

        let selected_index = 0;

        let request = new XMLHttpRequest();
        request.open("GET", "dbs/events.json", false);
        request.send(null);

        var event_json = JSON.parse(request.responseText);

        request = new XMLHttpRequest();
        request.open("POST", "dbs/events.json");
        request.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
        request.send(JSON.stringify(null));

        load_events(event_json);
        select_index(selected_index);

        function load_events(eventDB) {
            let event_list = ""

            for (let x in eventDB) {
                event_list += "<div class=\"event_object";
                if (x == selected_index) {
                    event_list += " selected_item"
                }
                event_list += "\" onclick=\"select_index(" + x + ")\">";
                event_list += "<h2>" + eventDB[x].name + "</h2>";
                event_list += "<h3>" + eventDB[x].date + "</h3>";
                event_list += "<p style=\"color: red; width:fit-content\" onclick=\"delete_event(" + x + ")\">[x]</p>"
                event_list += "</div>";
            }


            event_list += "<div class=\"event_object\" onclick=\"add_event()\"><h2>+</h2></div>";

            document.getElementById("list").innerHTML = event_list;
        }

        function add_event() {
            const today = new Date();
            event_json.push({
                "name": "new_event",
                "date": today.getFullYear() + "-" + pad(today.getMonth() + 1, 2) + "-" + pad(today.getDate(), 2)
            })


            select_index(event_json.length -1);

        }

        function apply_edits()
        {
            event_json[selected_index].name = document.getElementById("prop_event_name").innerHTML;
            event_json[selected_index].date = document.getElementById("prop_event_date").value;

            load_events(event_json);
        }

        function select_index(index) {
            selected_index = index;
            document.getElementById("prop_event_name").innerHTML = event_json[index].name;
            document.getElementById("prop_event_date").value = event_json[index].date;
            load_events(event_json);
        }

        function delete_event(event_index) {

            event_json.splice(event_index, 1);

            load_events(event_json);

        }

        function pad(num, size) {
            num = num.toString();
            while (num.length < size) num = "0" + num;
            return num;
        }


    </script>

</div>
</body>
</html>